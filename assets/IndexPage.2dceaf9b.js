import{P,r as m,w as C,S as f,U as g,V as i,f as l,ab as _,X as R,Y as S,a4 as a,ac as x,ad as B,a1 as Q,ae as F,a3 as L,af as V,ag as O,u as $,Z as k,a2 as y,a9 as b,F as N,a7 as j,ah as A,ai as G}from"./index.1575f272.js";import{Q as H}from"./QPage.220368aa.js";import{u as U}from"./vue-i18n.runtime.esm-bundler.feadb67a.js";import{APP_LANGUAGES as J}from"./i18n.d0dd61db.js";import{u as E}from"./use-quasar.bf3dff7f.js";import{O as K}from"./organ_donation.ae1bd3a9.js";import{A as X}from"./Patientenverfuegung.38954060.js";import{u as Y}from"./composables.647cdc77.js";import{d as Z,u as z,C as T}from"./fhir-questionnaire-renderer.a056aaac.js";const D=P({__name:"QuestionnaireSelector",emits:["questionnaireChanged"],setup(w,{emit:d}){const n=E(),{t:o,locale:u}=U(),q=[K,X],e=m(null),r=m(null),v=m(null),p=m(!1);return C(e,c=>{p.value=!1,c?fetch(c).then(s=>s.json()).then(s=>d("questionnaireChanged",s)).catch(s=>{n.notify({message:o("common.error"),type:"negative",position:"top-right"}),p.value=!0,console.error(s)}):d("questionnaireChanged",null)}),C(r,c=>{var s;p.value=!1,c?(s=r.value)==null||s.text().then(t=>d("questionnaireChanged",JSON.parse(t))).catch(t=>{n.notify({message:o("common.error"),type:"negative",position:"top-right"}),p.value=!0,console.error(t)}):d("questionnaireChanged",null)}),C(v,c=>{c?d("questionnaireChanged",c):d("questionnaireChanged",null)}),(c,s)=>(f(),g(O,{flat:"",bordered:""},{default:i(()=>[l(_,{class:"card-title"},{default:i(()=>[R(S(a(o)("questionnaire.selector.title")),1)]),_:1}),l(x),l(_,null,{default:i(()=>[l(B,{modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=t=>e.value=t),type:"url",outlined:"",label:a(o)("questionnaire.selector.descriptionURL"),clearable:"",debounce:"1000",disable:r.value!==null||v.value!==null,error:e.value!==null&&p.value},{prepend:i(()=>[l(Q,{name:"fa-solid fa-link"})]),_:1},8,["modelValue","label","disable","error"])]),_:1}),l(_,null,{default:i(()=>[l(F,{modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=t=>r.value=t),outlined:"",label:a(o)("questionnaire.selector.descriptionUpload"),clearable:"",disable:e.value!==null||v.value!==null,error:r.value!==null&&p.value},{prepend:i(()=>[l(Q,{name:"fa-solid fa-hard-drive"})]),_:1},8,["modelValue","label","disable","error"])]),_:1}),l(_,null,{default:i(()=>[l(L,{modelValue:v.value,"onUpdate:modelValue":s[2]||(s[2]=t=>v.value=t),options:q.map(t=>({label:t._title?a(V.readI18N)(t._title,a(u)):t.title,value:t})),"emit-value":"","map-options":"",label:a(o)("questionnaire.selector.descriptionDefault"),clearable:"",outlined:"",disable:e.value!==null||r.value!==null},{prepend:i(()=>[l(Q,{name:"fa-solid fa-list"})]),_:1},8,["modelValue","options","label","disable"])]),_:1})]),_:1}))}}),M={class:"col-12 col-lg-4"},W={class:"col-12 col-lg-8"},ee={class:"col-12"},ae={class:"col-12"},ce=P({__name:"IndexPage",setup(w){const d=E(),{t:n,locale:o}=U(),u=$(),q=Y(),e=m(),r=m(!1),v=m(-1);function p(t){t?(e.value=new Z.QuestionnaireData(t,J),e.value.populateAnswers([u.userResource])):e.value=void 0}function c(){var t,h;e.value&&e.value.isResponseComplete(!0,!0)&&(r.value=!0,z(e.value.getQuestionnaireResponse(o.value,{reset:!1,includeID:!0,patient:{reference:"https://test.ahdis.ch/mag-bfh/fhir/"+u.userResource.resourceType+"/"+u.userResource.id,display:u.userResource.name?V.getFullName(V.selectName(u.userResource.name)):""}}),u.userResource,{title:(t=e.value.getQuestionnaireTitle(o.value))!=null?t:A(),isFhir:!0,description:(h=e.value.getQuestionnaireTitle(o.value))!=null?h:A(),contentLanguage:o.value,sourceIdentifier:u.userSettings.OIDs.app,categoryCoding:{system:"http://snomed.info/sct",code:"184216000",display:"Patient record type"},typeCoding:{system:"http://snomed.info/sct",code:"419891008",display:"Record artifact (record artifact)"},facilityCoding:u.userSettings.facilityType,practiceSettingCoding:u.userSettings.practiceSetting,authorRole:G.PAT},q).then(()=>{d.notify({message:n("questionnaire.saved"),position:"top-right"}),s(),r.value=!1,v.value*=-1}).catch(I=>{d.notify({message:n("common.error"),type:"negative",position:"top-right"}),console.error(I),r.value=!1}))}function s(){e.value&&(e.value.resetResponse(),e.value.populateAnswers([u.userResource]))}return(t,h)=>(f(),g(H,{class:"full-width row justify-center content-start"},{default:i(()=>[a(d).platform.is.desktop?(f(),k(N,{key:0},[y("div",M,[l(D,{onQuestionnaireChanged:p})]),y("div",W,[e.value?(f(),g(O,{key:0,class:"q-pb-xs",flat:"",bordered:""},{default:i(()=>[l(_,{class:"card-title"},{default:i(()=>[R(S(e.value.getQuestionnaireTitle(a(o))),1)]),_:1}),l(x),l(_,{class:"q-pa-none"},{default:i(()=>[l(a(T),{"questionnaire-data":e.value,language:a(o),"translation-strings":{save:a(n)("questionnaire.save"),reset:a(n)("questionnaire.reset"),end:a(n)("questionnaire.end"),close:a(n)("common.close")},"disable-save":r.value,onSave:c,onReset:s},null,8,["questionnaire-data","language","translation-strings","disable-save"])]),_:1})]),_:1})):b("",!0)])],64)):b("",!0),a(d).platform.is.mobile?(f(),k(N,{key:1},[y("div",ee,[e.value===void 0?(f(),g(D,{key:0,onQuestionnaireChanged:p})):(f(),g(j,{key:1,flat:"",color:"primary",onClick:h[0]||(h[0]=I=>e.value=void 0)},{default:i(()=>[R(S(a(n)("common.back")),1)]),_:1}))]),y("div",ae,[e.value?(f(),g(a(T),{key:v.value,"questionnaire-data":e.value,language:a(o),"translation-strings":{save:a(n)("questionnaire.save"),reset:a(n)("questionnaire.reset"),end:a(n)("questionnaire.end"),close:a(n)("common.close")},"disable-save":r.value,onSave:c,onReset:s},null,8,["questionnaire-data","language","translation-strings","disable-save"])):b("",!0)])],64)):b("",!0)]),_:1}))}});export{ce as default};
