import{k as T,r as v,K as $,at as j,av as G,o as K,h as O,l as H,g as J,aF as W,aG as q,E as X,aH as Y,aI as z,d as Z,a7 as ee,aJ as ae,u as te,aK as oe,U as S,V as E,W as P,a3 as V,j as m,ac as I,X as L,Y as h,a5 as u,ad as ne,ae as B,a8 as U,$ as D,aa as M,ag as se}from"./index.52235235.js";import{Q as le}from"./QPage.f751d244.js";import{u as re}from"./use-quasar.f6ab1d7d.js";import{u as ie}from"./composables.ec6216f8.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import{u as de}from"./vue-i18n.runtime.608e3319.js";var R=T({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(b,{slots:x,emit:o}){const k=J(),p=v(null);let g=0;const i=[];function y(e){const c=typeof e=="boolean"?e:b.noErrorFocus!==!0,_=++g,A=(n,r)=>{o(`validation${n===!0?"Success":"Error"}`,r)},C=n=>{const r=n.validate();return typeof r.then=="function"?r.then(a=>({valid:a,comp:n}),a=>({valid:!1,comp:n,err:a})):Promise.resolve({valid:r,comp:n})};return(b.greedy===!0?Promise.all(i.map(C)).then(n=>n.filter(r=>r.valid!==!0)):i.reduce((n,r)=>n.then(()=>C(r).then(a=>{if(a.valid===!1)return Promise.reject(a)})),Promise.resolve()).catch(n=>[n])).then(n=>{if(n===void 0||n.length===0)return _===g&&A(!0),!0;if(_===g){const{comp:r,err:a}=n[0];if(a!==void 0&&console.error(a),A(!1,r),c===!0){const t=n.find(({comp:s})=>typeof s.focus=="function"&&W(s.$)===!1);t!==void 0&&t.comp.focus()}}return!1})}function l(){g++,i.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function d(e){e!==void 0&&q(e);const c=g+1;y().then(_=>{c===g&&_===!0&&(b.onSubmit!==void 0?o("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function w(e){e!==void 0&&q(e),o("reset"),X(()=>{l(),b.autofocus===!0&&b.noResetFocus!==!0&&f()})}function f(){Y(()=>{if(p.value===null)return;const e=p.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||p.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||p.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(p.value.querySelectorAll("[tabindex]"),c=>c.tabIndex!==-1);e!=null&&e.focus({preventScroll:!0})})}$(z,{bindComponent(e){i.push(e)},unbindComponent(e){const c=i.indexOf(e);c!==-1&&i.splice(c,1)}});let N=!1;return j(()=>{N=!0}),G(()=>{N===!0&&b.autofocus===!0&&f()}),K(()=>{b.autofocus===!0&&f()}),Object.assign(k.proxy,{validate:y,resetValidation:l,submit:d,reset:w,focus:f,getValidationComponents:()=>i}),()=>O("form",{class:"q-form",ref:p,onSubmit:d,onReset:w},H(x.default))}}),ce=[{emailAddress:"dev@on.ly",password:"test",mobilePhoneNumber:"079 123 45 67",firstName:"Matteo",lastName:"Lecomte"},{emailAddress:"peter@gerber.ch",password:"test",mobilePhoneNumber:"079 123 45 68",firstName:"Peter",lastName:"Gerber"},{emailAddress:"readonly@bfh.ch",password:"do-not-write",mobilePhoneNumber:"+41 77 123 987",firstName:"Ren\xE9",lastName:"Gerber"},{emailAddress:"m@ria.ch",password:"maria",mobilePhoneNumber:"079 111 22 33",firstName:"Maria",lastName:"Schmid"},{emailAddress:"elisabeth@broennimann.today",password:"19kurt69",firstName:"Elisabeth",lastName:"Br\xF6nnimann",mobilePhoneNumber:"+41 32 321 61 11"},{emailAddress:"matteo@mail.li",password:"test",mobilePhoneNumber:"079 123 45 67",firstName:"Matteo",lastName:"Lagrande"},{emailAddress:"pat67@approches.ch",password:"laur3nt",firstName:"Patricia",lastName:"Laurent",mobilePhoneNumber:"+41 32 321 61 11"},{emailAddress:"laura.baumann@test.ch",password:"l4ur4",firstName:"Laura",lastName:"Baumann",mobilePhoneNumber:"078 563 48 32"}];const me={class:"col-12 col-md-4",style:{overflow:"auto"}},fe={class:"text-body2"},ve={key:0,class:"text-body2 warning"},be={class:"text-body2"},pe={class:"phonenumber"},ge={key:0,class:"text-body2 warning"},he=Z({__name:"LoginPage",setup(b){const x=re(),{t:o}=de(),k=ee(),p=ae(),g=te(),i=v(""),y=v(""),l=v(oe),d=v(!1),w=v(!1),f=v(null),N=v(""),e=v(!1),{epdUtils:c}=ie();function _(a){a.preventDefault();const t=ce.find(s=>s.emailAddress===i.value);t&&t.password===y.value?(l.value=t,C()):w.value=!0}function A(){d.value=!0,c.useITI78({given:l.value.firstName,family:l.value.lastName}).then(a=>{var t,s;a.length===0?(x.notify({message:o("common.error"),caption:o("login.loginError"),type:"negative",position:"top-right"}),console.error("No corresponding patient found on EPD Playground for "+l.value.firstName+" "+l.value.lastName+"."),d.value=!1):(g.$patch({user:l.value,userResource:a[0]}),k.push({path:(s=(t=p.redirectedFrom)==null?void 0:t.path)!=null?s:"/"}))}).catch(a=>{x.notify({message:o("common.error"),caption:o("login.loginError"),type:"negative",position:"top-right"}),console.error("Something went wrong logging in",a),d.value=!1})}function C(){F(4),x.notify({message:o("login.messageTitle")+l.value.mobilePhoneNumber,caption:o("login.messageText")+f.value,position:"top-right"})}function F(a){const t=Math.floor(Math.random()*Math.pow(10,a)).toString();f.value="0".repeat(t.length-a)+t}function n(a){a.preventDefault(),f.value===N.value&&l.value?A():e.value=!0}function r(){var a,t,s,Q;return((a=l.value)==null?void 0:a.mobilePhoneNumber.substring(0,2))+"\u2022 \u2022\u2022\u2022 "+((Q=l.value)==null?void 0:Q.mobilePhoneNumber.substring(((t=l.value)==null?void 0:t.mobilePhoneNumber.length)-5,(s=l.value)==null?void 0:s.mobilePhoneNumber.length))}return(a,t)=>(S(),E(le,{class:"full-width row justify-center content-start"},{default:P(()=>[V("div",me,[m(se,{flat:"",bordered:""},{default:P(()=>[m(I,{class:"card-title"},{default:P(()=>[L(h(u(o)("login.welcome1")),1)]),_:1}),m(ne),f.value?(S(),E(I,{key:1},{default:P(()=>[V("p",be,[L(h(u(o)("login.enterCode1"))+" ",1),V("span",pe,h(r()),1),L(" "+h(u(o)("login.enterCode2")),1)]),V("span",{href:"#",class:"text-body2 resend-link",onClick:t[2]||(t[2]=s=>C())},h(u(o)("login.resend")),1),m(R,{id:"code-form",style:{"text-align":"center"}},{default:P(()=>[m(B,{modelValue:N.value,"onUpdate:modelValue":t[3]||(t[3]=s=>N.value=s),class:"q-my-md",outlined:"",type:"text",label:u(o)("login.codeLabel"),autofocus:""},null,8,["modelValue","label"]),m(U,{id:"code-button",unelevated:"",color:"primary","text-color":"onPrimary",type:"submit",loading:d.value,label:u(o)("login.checkLabel"),disable:d.value||N.value==="",onClick:n},null,8,["loading","label","disable"])]),_:1}),e.value?(S(),D("p",ge,h(u(o)("login.invalidCode")),1)):M("",!0)]),_:1})):(S(),E(I,{key:0},{default:P(()=>[V("p",fe,h(u(o)("login.welcome2")),1),m(R,{class:"",style:{"text-align":"center"}},{default:P(()=>[m(B,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s),class:"q-my-md",outlined:"",type:"email",label:u(o)("login.emailAddressLabel")},null,8,["modelValue","label"]),m(B,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),class:"q-my-md",outlined:"",type:"password",label:u(o)("login.passwordLabel")},null,8,["modelValue","label"]),m(U,{id:"login-button",unelevated:"",color:"primary","text-color":"onPrimary",type:"submit",loading:d.value,label:u(o)("login.loginLabel"),disable:d.value||y.value===""||i.value==="",onClick:_},null,8,["loading","label","disable"])]),_:1}),w.value?(S(),D("p",ve,h(u(o)("login.invalidPassword")),1)):M("",!0)]),_:1}))]),_:1})])]),_:1}))}});var Ce=ue(he,[["__scopeId","data-v-dac321d4"]]);export{Ce as default};
