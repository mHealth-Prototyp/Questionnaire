import{d as D,r as g,w as C,U as f,V as h,W as i,j as l,X as R,Y as S,a5 as a,ac as y,ad as O,ae as j,a1 as Q,af as B,a4 as F,ag as P,ah as V,u as L,$ as k,a3 as b,aa as q,F as N,a8 as $,ai as A,aj as G}from"./index.52235235.js";import{Q as H}from"./QPage.f751d244.js";import{APP_LANGUAGES as J}from"./i18n.c2243f2d.js";import{u as U}from"./use-quasar.f6ab1d7d.js";import{O as K}from"./organ_donation.ae1bd3a9.js";import{A as W}from"./Patientenverfuegung.38954060.js";import{u as E}from"./vue-i18n.runtime.608e3319.js";import{u as X}from"./composables.ec6216f8.js";import{d as Y,u as z,x as T}from"./fhir-questionnaire-renderer.713a4278.js";const x=D({__name:"QuestionnaireSelector",emits:["questionnaireChanged"],setup(w,{emit:_}){const n=U(),{t:o,locale:r}=E(),v=_,t=[K,W],u=g(null),c=g(null),m=g(null),p=g(!1);return C(u,d=>{p.value=!1,d?fetch(d).then(e=>e.json()).then(e=>v("questionnaireChanged",e)).catch(e=>{n.notify({message:o("common.error"),type:"negative",position:"top-right"}),p.value=!0,console.error(e)}):v("questionnaireChanged",null)}),C(c,d=>{var e;p.value=!1,d?(e=c.value)==null||e.text().then(s=>v("questionnaireChanged",JSON.parse(s))).catch(s=>{n.notify({message:o("common.error"),type:"negative",position:"top-right"}),p.value=!0,console.error(s)}):v("questionnaireChanged",null)}),C(m,d=>{d?v("questionnaireChanged",d):v("questionnaireChanged",null)}),(d,e)=>(f(),h(P,{flat:"",bordered:""},{default:i(()=>[l(y,{class:"card-title"},{default:i(()=>[R(S(a(o)("questionnaire.selector.title")),1)]),_:1}),l(O),l(y,null,{default:i(()=>[l(j,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),type:"url",outlined:"",label:a(o)("questionnaire.selector.descriptionURL"),clearable:"",debounce:"1000",disable:c.value!==null||m.value!==null,error:u.value!==null&&p.value},{prepend:i(()=>[l(Q,{name:"fa-solid fa-link"})]),_:1},8,["modelValue","label","disable","error"])]),_:1}),l(y,null,{default:i(()=>[l(B,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),outlined:"",label:a(o)("questionnaire.selector.descriptionUpload"),clearable:"",disable:u.value!==null||m.value!==null,error:c.value!==null&&p.value},{prepend:i(()=>[l(Q,{name:"fa-solid fa-hard-drive"})]),_:1},8,["modelValue","label","disable","error"])]),_:1}),l(y,null,{default:i(()=>[l(F,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=s=>m.value=s),options:t.map(s=>({label:s._title?a(V.readI18N)(s._title,a(r)):s.title,value:s})),"emit-value":"","map-options":"",label:a(o)("questionnaire.selector.descriptionDefault"),clearable:"",outlined:"",disable:u.value!==null||c.value!==null},{prepend:i(()=>[l(Q,{name:"fa-solid fa-list"})]),_:1},8,["modelValue","options","label","disable"])]),_:1})]),_:1}))}}),M={class:"col-12 col-lg-4"},Z={class:"col-12 col-lg-8"},ee={class:"col-12"},ae={class:"col-12"},ce=D({__name:"IndexPage",setup(w){const _=U(),{t:n,locale:o}=E(),r=L(),v=X(),t=g(),u=g(!1),c=g(-1);function m(e){e?(t.value=new Y.QuestionnaireData(e,J),t.value.populateAnswers([r.userResource])):t.value=void 0}function p(){var e,s;t.value&&t.value.isResponseComplete(!0,!0)&&(u.value=!0,z(t.value.getQuestionnaireResponse(o.value,{reset:!1,includeID:!0,patient:{reference:"https://test.ahdis.ch/mag-bfh/fhir/"+r.userResource.resourceType+"/"+r.userResource.id,display:r.userResource.name?V.getFullName(V.selectName(r.userResource.name)):""}}),r.userResource,{title:(e=t.value.getQuestionnaireTitle(o.value))!=null?e:A(),isFhir:!0,description:(s=t.value.getQuestionnaireTitle(o.value))!=null?s:A(),contentLanguage:o.value,sourceIdentifier:r.userSettings.OIDs.app,categoryCoding:{system:"http://snomed.info/sct",code:"184216000",display:"Patient record type"},typeCoding:{system:"http://snomed.info/sct",code:"419891008",display:"Record artifact (record artifact)"},facilityCoding:r.userSettings.facilityType,practiceSettingCoding:r.userSettings.practiceSetting,authorRole:G.PAT},v).then(()=>{_.notify({message:n("questionnaire.saved"),position:"top-right"}),d(),u.value=!1,c.value*=-1}).catch(I=>{_.notify({message:n("common.error"),type:"negative",position:"top-right"}),console.error(I),u.value=!1}))}function d(){t.value&&(t.value.resetResponse(),t.value.populateAnswers([r.userResource]))}return(e,s)=>(f(),h(H,{class:"full-width row justify-center content-start"},{default:i(()=>[a(_).platform.is.desktop?(f(),k(N,{key:0},[b("div",M,[l(x,{onQuestionnaireChanged:m})]),b("div",Z,[t.value?(f(),h(P,{key:0,class:"q-pb-xs",flat:"",bordered:""},{default:i(()=>[l(y,{class:"card-title"},{default:i(()=>[R(S(t.value.getQuestionnaireTitle(a(o))),1)]),_:1}),l(O),l(y,{class:"q-pa-none"},{default:i(()=>[l(a(T),{"questionnaire-data":t.value,language:a(o),"translation-strings":{save:a(n)("questionnaire.save"),reset:a(n)("questionnaire.reset"),end:a(n)("questionnaire.end"),close:a(n)("common.close")},"disable-save":u.value,onSave:p,onReset:d},null,8,["questionnaire-data","language","translation-strings","disable-save"])]),_:1})]),_:1})):q("",!0)])],64)):q("",!0),a(_).platform.is.mobile?(f(),k(N,{key:1},[b("div",ee,[t.value===void 0?(f(),h(x,{key:0,onQuestionnaireChanged:m})):(f(),h($,{key:1,flat:"",color:"primary",onClick:s[0]||(s[0]=I=>t.value=void 0)},{default:i(()=>[R(S(a(n)("common.back")),1)]),_:1}))]),b("div",ae,[t.value?(f(),h(a(T),{key:c.value,"questionnaire-data":t.value,language:a(o),"translation-strings":{save:a(n)("questionnaire.save"),reset:a(n)("questionnaire.reset"),end:a(n)("questionnaire.end"),close:a(n)("common.close")},"disable-save":u.value,onSave:p,onReset:d},null,8,["questionnaire-data","language","translation-strings","disable-save"])):q("",!0)])],64)):q("",!0)]),_:1}))}});export{ce as default};
