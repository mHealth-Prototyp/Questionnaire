import{j as T,r as v,I as j,aE as G,as as $,at as O,o as H,h as J,k as K,g as X,aF as Y,aG as q,C as Z,aH as z,P as W,a6 as ee,aI as ae,u as oe,aJ as te,S,U as E,V as P,a2 as V,f as m,ab as I,X as L,Y as h,a4 as u,ac as ne,ad as B,a7 as U,Z as D,a9 as M,ag as se}from"./index.4018be15.js";import{Q as le}from"./QPage.d757639b.js";import{u as re}from"./use-quasar.9afcef12.js";import{u as ie}from"./composables.7026f804.js";import{u as ue}from"./vue-i18n.runtime.esm-bundler.f1c77e2a.js";import{_ as de}from"./plugin-vue_export-helper.21dcd24c.js";var R=T({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(p,{slots:w,emit:t}){const k=X(),b=v(null);let g=0;const i=[];function y(e){const c=typeof e=="boolean"?e:p.noErrorFocus!==!0,_=++g,A=(n,r)=>{t("validation"+(n===!0?"Success":"Error"),r)},C=n=>{const r=n.validate();return typeof r.then=="function"?r.then(a=>({valid:a,comp:n}),a=>({valid:!1,comp:n,err:a})):Promise.resolve({valid:r,comp:n})};return(p.greedy===!0?Promise.all(i.map(C)).then(n=>n.filter(r=>r.valid!==!0)):i.reduce((n,r)=>n.then(()=>C(r).then(a=>{if(a.valid===!1)return Promise.reject(a)})),Promise.resolve()).catch(n=>[n])).then(n=>{if(n===void 0||n.length===0)return _===g&&A(!0),!0;if(_===g){const{comp:r,err:a}=n[0];if(a!==void 0&&console.error(a),A(!1,r),c===!0){const o=n.find(({comp:s})=>typeof s.focus=="function"&&Y(s.$)===!1);o!==void 0&&o.comp.focus()}}return!1})}function l(){g++,i.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function d(e){e!==void 0&&q(e);const c=g+1;y().then(_=>{c===g&&_===!0&&(p.onSubmit!==void 0?t("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function x(e){e!==void 0&&q(e),t("reset"),Z(()=>{l(),p.autofocus===!0&&p.noResetFocus!==!0&&f()})}function f(){z(()=>{if(b.value===null)return;const e=b.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||b.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||b.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(b.value.querySelectorAll("[tabindex]"),c=>c.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}j(G,{bindComponent(e){i.push(e)},unbindComponent(e){const c=i.indexOf(e);c>-1&&i.splice(c,1)}});let N=!1;return $(()=>{N=!0}),O(()=>{N===!0&&p.autofocus===!0&&f()}),H(()=>{p.autofocus===!0&&f()}),Object.assign(k.proxy,{validate:y,resetValidation:l,submit:d,reset:x,focus:f,getValidationComponents:()=>i}),()=>J("form",{class:"q-form",ref:b,onSubmit:d,onReset:x},K(w.default))}}),ce=[{emailAddress:"dev@on.ly",password:"test",mobilePhoneNumber:"079 123 45 67",firstName:"Matteo",lastName:"Lecomte"},{emailAddress:"peter@gerber.ch",password:"test",mobilePhoneNumber:"079 123 45 68",firstName:"Peter",lastName:"Gerber"},{emailAddress:"readonly@bfh.ch",password:"do-not-write",mobilePhoneNumber:"+41 77 123 987",firstName:"Ren\xE9",lastName:"Gerber"},{emailAddress:"m@ria.ch",password:"maria",mobilePhoneNumber:"079 111 22 33",firstName:"Maria",lastName:"Schmid"},{emailAddress:"elisabeth@broennimann.today",password:"19kurt69",firstName:"Elisabeth",lastName:"Br\xF6nnimann",mobilePhoneNumber:"+41 32 321 61 11"},{emailAddress:"matteo@mail.li",password:"test",mobilePhoneNumber:"079 123 45 67",firstName:"Matteo",lastName:"Lagrande"},{emailAddress:"pat67@approches.ch",password:"laur3nt",firstName:"Patricia",lastName:"Laurent",mobilePhoneNumber:"+41 32 321 61 11"},{emailAddress:"laura.baumann@test.ch",password:"l4ur4",firstName:"Laura",lastName:"Baumann",mobilePhoneNumber:"078 563 48 32"}];const me={class:"col-12 col-md-4",style:{overflow:"auto"}},fe={class:"text-body2"},ve={key:0,class:"text-body2 warning"},pe={class:"phonenumber"},be={key:0,class:"warning"},ge=W({__name:"LoginPage",setup(p){const w=re(),{t}=ue(),k=ee(),b=ae(),g=oe(),i=v(""),y=v(""),l=v(te),d=v(!1),x=v(!1),f=v(null),N=v(""),e=v(!1),{epdUtils:c}=ie();function _(a){a.preventDefault();const o=ce.find(s=>s.emailAddress===i.value);o&&o.password===y.value?(l.value=o,C()):x.value=!0}function A(){d.value=!0,c.useITI78({given:l.value.firstName,family:l.value.lastName}).then(a=>{var o,s;a.length===0?(w.notify({message:t("common.error"),caption:t("login.loginError"),type:"negative",position:"top-right"}),console.error("No corresponding patient found on EPD Playground for "+l.value.firstName+" "+l.value.lastName+"."),d.value=!1):(g.$patch({user:l.value,userResource:a[0]}),k.push({path:(s=(o=b.redirectedFrom)==null?void 0:o.path)!=null?s:"/"}))}).catch(a=>{w.notify({message:t("common.error"),caption:t("login.loginError"),type:"negative",position:"top-right"}),console.error("Something went wrong logging in",a),d.value=!1})}function C(){F(4),w.notify({message:t("login.messageTitle")+l.value.mobilePhoneNumber,caption:t("login.messageText")+f.value,position:"top-right"})}function F(a){const o=Math.floor(Math.random()*Math.pow(10,a)).toString();f.value="0".repeat(o.length-a)+o}function n(a){a.preventDefault(),f.value===N.value&&l.value?A():e.value=!0}function r(){var a,o,s,Q;return((a=l.value)==null?void 0:a.mobilePhoneNumber.substring(0,2))+"\u2022 \u2022\u2022\u2022 "+((Q=l.value)==null?void 0:Q.mobilePhoneNumber.substring(((o=l.value)==null?void 0:o.mobilePhoneNumber.length)-5,(s=l.value)==null?void 0:s.mobilePhoneNumber.length))}return(a,o)=>(S(),E(le,{class:"full-width row justify-center content-start"},{default:P(()=>[V("div",me,[m(se,{flat:"",bordered:""},{default:P(()=>[m(I,{class:"card-title"},{default:P(()=>[L(h(u(t)("login.welcome1")),1)]),_:1}),m(ne),f.value?(S(),E(I,{key:1},{default:P(()=>[V("p",null,[L(h(u(t)("login.enterCode1"))+" ",1),V("span",pe,h(r()),1),L(" "+h(u(t)("login.enterCode2")),1)]),V("span",{href:"#",class:"resend-link",onClick:o[2]||(o[2]=s=>C())},h(u(t)("login.resend")),1),m(R,{id:"code-form"},{default:P(()=>[m(B,{modelValue:N.value,"onUpdate:modelValue":o[3]||(o[3]=s=>N.value=s),label:"Code",type:"text",autofocus:""},null,8,["modelValue"]),m(U,{id:"code-button",color:"primary","text-color":"onPrimary",label:u(t)("login.checkLabel"),type:"submit",loading:d.value,disable:d.value||N.value==="",onClick:n},null,8,["label","loading","disable"])]),_:1}),e.value?(S(),D("p",be,h(u(t)("login.invalidCode")),1)):M("",!0)]),_:1})):(S(),E(I,{key:0},{default:P(()=>[V("p",fe,h(u(t)("login.welcome2")),1),m(R,{class:"",style:{"text-align":"center"}},{default:P(()=>[m(B,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),class:"q-my-md",outlined:"",type:"email",label:u(t)("login.emailAddressLabel")},null,8,["modelValue","label"]),m(B,{modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=s=>y.value=s),class:"q-my-md",outlined:"",type:"password",label:u(t)("login.passwordLabel")},null,8,["modelValue","label"]),m(U,{id:"login-button",unelevated:"",color:"primary","text-color":"onPrimary",type:"submit",loading:d.value,label:u(t)("login.loginLabel"),disable:d.value||y.value===""||i.value==="",onClick:_},null,8,["loading","label","disable"])]),_:1}),x.value?(S(),D("p",ve,h(u(t)("login.invalidPassword")),1)):M("",!0)]),_:1}))]),_:1})])]),_:1}))}});var xe=de(ge,[["__scopeId","data-v-be5c0426"]]);export{xe as default};
